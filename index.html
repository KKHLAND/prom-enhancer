<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M9.937 15.5L12 21l2.063-5.5L19.5 13.5 14.063 12 12 6.5 9.937 12 4.5 13.5l5.437 1.5zM21 3l-1.5 1.5M3 21l1.5-1.5' /%3E%3C/svg%3E" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI 프롬프트 개선기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #d1fae5;
        }
        ::-webkit-scrollbar-thumb {
            background: #6ee7b7;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #34d399;
        }
    </style>
</head>
<body class="bg-emerald-50 text-slate-900 antialiased">
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@google/generative-ai@0.1.3/dist/index.js"></script>

    <script type="module">
        const { useState, useCallback } = React;
        const e = React.createElement;

        // --- 아이콘 컴포넌트 ---
        const SparklesIcon = (props) => e('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, e('path', { d: "M9.937 15.5L12 21l2.063-5.5L19.5 13.5 14.063 12 12 6.5 9.937 12 4.5 13.5l5.437 1.5zM21 3l-1.5 1.5M3 21l1.5-1.5" }));
        const ClipboardIcon = (props) => e('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, e('rect', { width: "8", height: "4", x: "8", y: "2", rx: "1", ry: "1" }), e('path', { d: "M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" }));
        const CheckIcon = (props) => e('svg', { ...props, xmlns: "http://www.w3.org/2000/svg", width: "24", height: "24", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, e('path', { d: "M20 6 9 17l-5-5" }));

        // --- Gemini 서비스 ---
        const API_KEY = "YOUR_API_KEY"; // 여기에 실제 Gemini API 키를 입력하세요.
        const genAI = new genai.GoogleGenerativeAI(API_KEY);

        const enhancePrompt = async (originalPrompt) => {
            try {
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                const systemInstruction = `당신은 컨텍스트 엔지니어링 기법을 전문으로 하는 세계 최고 수준의 프롬프트 엔지니어입니다.
당신의 임무는 사용자의 초기 프롬프트를 받아 3가지 독특하고 창의적인 구조화된 프롬프트 변형으로 개선하는 것입니다.
각 변형은 다음 구조를 따라야 합니다: 미션, 페르소나, 청중, 목표, 톤앤매너, 절차, 제약 조건, 출력 형식.
이러한 구조화된 구성 요소를 사용하여 원래 아이디어를 훨씬 더 상세하고, 맥락에 맞으며, 모든 LLM에 효과적인 프롬프트로 변환하는 데 집중하세요.

- **미션 (Mission):** AI의 전반적인 임무를 정의합니다.
- **페르소나 (Persona):** AI가 채택해야 할 역할이나 캐릭터를 지정합니다. 적절하지 않은 경우 '해당 없음'으로 표시할 수 있습니다.
- **청중 (Audience):** 결과물을 소비할 대상을 지정합니다 (예: 5세 어린이, 기술 전문가).
- **목표 (Goal):** 달성하고자 하는 구체적인 결과물을 설명합니다.
- **톤앤매너 (Tone & Manner):** AI가 사용해야 할 어조와 스타일을 설명합니다 (예: 전문적, 유머러스).
- **절차 (Procedure):** 목표를 달성하기 위해 따라야 할 단계나 규칙을 제시합니다.
- **제약 조건 (Constraints):** AI가 피해야 할 사항이나 반드시 지켜야 할 규칙을 명시합니다 (예: 200단어 미만).
- **출력 형식 (Output Format):** 결과물이 어떤 형식(예: 마크다운, JSON, 글머리 기호 목록)이어야 하는지 명시합니다.

각 변형에 대해 제목, 구조화된 프롬프트 구성 요소들, 그리고 이러한 개선이 왜 프롬프트를 더 강력하게 만드는지에 대한 명확한 근거를 제공하세요.`;

                const prompt = `${systemInstruction}\n\n개선할 프롬프트는 다음과 같습니다: "${originalPrompt}"\n\nJSON 형식으로 3가지 제안을 반환해주세요. 각 제안에는 title, reasoning, mission, persona, audience, goal, toneAndManner, procedure, constraints, outputFormat 필드가 포함되어야 합니다.`;
                
                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();

                // 마크다운 JSON 코드 블록에서 순수 JSON 추출
                const jsonMatch = text.match(/```json\s*([\s\S]*?)\s*```/);
                if (!jsonMatch) {
                    // JSON 코드 블록이 없는 경우, 텍스트가 순수 JSON이라고 가정
                    try {
                        const parsed = JSON.parse(text);
                        return Array.isArray(parsed) ? parsed : [parsed]; // 항상 배열을 반환하도록 보장
                    } catch (e) {
                         console.error("Failed to parse JSON directly:", e);
                         throw new Error("API가 예상치 못한 형식을 반환했습니다. 응답 텍스트를 확인해주세요.");
                    }
                }

                const jsonString = jsonMatch[1];
                const suggestions = JSON.parse(jsonString);
                
                if (!Array.isArray(suggestions)) {
                    // 때때로 API가 배열 대신 단일 객체를 반환할 수 있습니다.
                    if(typeof suggestions === 'object' && suggestions !== null) {
                        return [suggestions];
                    }
                    throw new Error("API가 예상치 못한 형식을 반환했습니다.");
                }

                return suggestions;

            } catch (error) {
                console.error("Error enhancing prompt:", error);
                throw new Error(`Gemini API에서 제안을 가져오지 못했습니다: ${error.message}`);
            }
        };

        // --- 컴포넌트 ---
        const PromptInput = ({ prompt, setPrompt, onSubmit, isLoading }) => {
            return e('div', { className: "h-full flex flex-col" },
                e('label', { htmlFor: "prompt-input", className: "text-xl font-semibold text-slate-700 mb-4" }, "원본 프롬프트"),
                e('textarea', {
                    id: "prompt-input",
                    value: prompt,
                    onChange: (e) => setPrompt(e.target.value),
                    placeholder: "예: 고등학생 학습 플래너 작성",
                    className: "flex-grow w-full bg-emerald-50/50 border border-emerald-300 rounded-lg p-4 text-slate-800 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-200 resize-none min-h-[250px] sm:min-h-[300px] text-base",
                    rows: 10,
                    disabled: isLoading
                }),
                e('button', {
                    onClick: onSubmit,
                    disabled: isLoading || !prompt.trim(),
                    className: "mt-5 w-full inline-flex items-center justify-center px-6 py-3.5 border border-transparent text-base font-medium rounded-lg shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 disabled:bg-emerald-400/80 disabled:cursor-not-allowed transition-all duration-300"
                },
                    isLoading ?
                        e(React.Fragment, null,
                            e('svg', { className: "animate-spin -ml-1 mr-3 h-5 w-5 text-white", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24" },
                                e('circle', { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
                                e('path', { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
                            ),
                            "개선 중..."
                        ) :
                        e(React.Fragment, null,
                            e(SparklesIcon, { className: "w-5 h-5 mr-2" }),
                            "프롬프트 개선"
                        )
                )
            );
        };

        const SuggestionCard = ({ suggestion }) => {
            const [isCopied, setIsCopied] = useState(false);

            const PromptSection = ({ title, content }) => {
                if (!content || content.toLowerCase() === '해당 없음' || content.toLowerCase() === 'n/a') return null;
                return e('div', null,
                    e('h4', { className: "font-semibold text-emerald-700 text-sm tracking-wider uppercase" }, title),
                    e('p', { className: "text-slate-700 mt-1 whitespace-pre-wrap font-mono text-sm leading-relaxed" }, content)
                );
            };
            
            const handleCopy = () => {
                const { mission, persona, audience, goal, toneAndManner, procedure, constraints, outputFormat } = suggestion;
                const sections = [
                    { title: "## 미션 (Mission)", content: mission },
                    { title: "## 페르소나 (Persona)", content: persona },
                    { title: "## 청중 (Audience)", content: audience },
                    { title: "## 목표 (Goal)", content: goal },
                    { title: "## 톤앤매너 (Tone & Manner)", content: toneAndManner },
                    { title: "## 절차 (Procedure)", content: procedure },
                    { title: "## 제약 조건 (Constraints)", content: constraints },
                    { title: "## 출력 형식 (Output Format)", content: outputFormat },
                ];
                
                const fullPrompt = sections
                    .filter(sec => sec.content && sec.content.toLowerCase() !== '해당 없음' && sec.content.toLowerCase() !== 'n/a')
                    .map(sec => `${sec.title}\n${sec.content}`)
                    .join('\n\n');

                navigator.clipboard.writeText(fullPrompt);
                setIsCopied(true);
                setTimeout(() => setIsCopied(false), 2000);
            };

            return e('div', { className: "bg-white border border-emerald-200 rounded-xl p-5 transition-all duration-300 hover:border-emerald-400/50 hover:shadow-lg hover:shadow-emerald-500/10" },
                e('div', { className: "flex justify-between items-start mb-4" },
                    e('h3', { className: "text-lg font-bold text-emerald-600" }, suggestion.title),
                    e('button', {
                        onClick: handleCopy,
                        className: `p-1.5 rounded-md transition-colors duration-200 ${isCopied ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-100 hover:bg-slate-200 text-slate-500 hover:text-slate-800'}`,
                        'aria-label': "프롬프트 복사"
                    },
                        isCopied ? e(CheckIcon, { className: "w-5 h-5" }) : e(ClipboardIcon, { className: "w-5 h-5" })
                    )
                ),
                e('div', { className: "space-y-4 bg-emerald-50/80 p-4 rounded-lg mb-4 border border-emerald-200/80" },
                    e(PromptSection, { title: "미션", content: suggestion.mission }),
                    e(PromptSection, { title: "페르소나", content: suggestion.persona }),
                    e(PromptSection, { title: "청중", content: suggestion.audience }),
                    e(PromptSection, { title: "목표", content: suggestion.goal }),
                    e(PromptSection, { title: "톤앤매너", content: suggestion.toneAndManner }),
                    e(PromptSection, { title: "절차", content: suggestion.procedure }),
                    e(PromptSection, { title: "제약 조건", content: suggestion.constraints }),
                    e(PromptSection, { title: "출력 형식", content: suggestion.outputFormat })
                ),
                e('div', null,
                    e('h4', { className: "font-semibold text-slate-600 text-sm" }, "개선 이유:"),
                    e('p', { className: "text-slate-600 text-sm" }, suggestion.reasoning)
                )
            );
        };

        const SuggestionsDisplay = ({ suggestions, isLoading, error, initialPrompt }) => {
            const hasSuggestions = suggestions.length > 0;
            const LoadingSkeleton = () => e('div', { className: "space-y-6" },
                [...Array(3)].map((_, i) => e('div', { key: i, className: "bg-white rounded-xl p-5 border border-emerald-200 animate-pulse" },
                    e('div', { className: "h-6 bg-emerald-200 rounded w-1/3 mb-4" }),
                    e('div', { className: "h-4 bg-emerald-200 rounded w-full mb-2" }),
                    e('div', { className: "h-4 bg-emerald-200 rounded w-5/6 mb-4" }),
                    e('div', { className: "h-4 bg-emerald-200 rounded w-1/2" })
                ))
            );

            return e('div', { className: "h-full flex flex-col" },
                e('h2', { className: "text-xl font-semibold text-slate-700 mb-4" }, "AI 개선 제안"),
                e('div', { className: "flex-grow overflow-y-auto pr-2 -mr-2" },
                    isLoading && e(LoadingSkeleton),
                    error && e('div', { className: "flex flex-col items-center justify-center h-full text-center text-red-600 bg-red-50 p-6 rounded-lg" },
                        e('p', { className: "font-semibold text-lg" }, "오류가 발생했습니다"),
                        e('p', { className: "mt-1" }, error)
                    ),
                    !isLoading && !error && !hasSuggestions && e('div', { className: "flex flex-col items-center justify-center h-full text-center text-slate-500 bg-emerald-50/70 rounded-lg p-6" },
                        e(SparklesIcon, { className: "w-12 h-12 mb-4 text-emerald-400" }),
                        e('p', { className: "font-semibold text-slate-600" }, "개선된 프롬프트가 여기에 표시됩니다."),
                        e('p', { className: "text-sm mt-1" }, "프롬프트를 입력하고 \"프롬프트 개선\"을 클릭하여 시작하세요.")
                    ),
                    !isLoading && !error && hasSuggestions && e('div', { className: "space-y-5" },
                        suggestions.map((suggestion, index) => e(SuggestionCard, { key: index, suggestion: suggestion }))
                    )
                )
            );
        };

        // --- 메인 앱 컴포넌트 ---
        const App = () => {
            const [initialPrompt, setInitialPrompt] = useState('');
            const [enhancedPrompts, setEnhancedPrompts] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleEnhancePrompt = useCallback(async () => {
                if (!initialPrompt.trim()) {
                    setError('개선할 프롬프트를 입력해주세요.');
                    return;
                }
                setIsLoading(true);
                setError(null);
                setEnhancedPrompts([]);

                try {
                    const suggestions = await enhancePrompt(initialPrompt);
                    setEnhancedPrompts(suggestions);
                } catch (err) {
                    console.error(err);
                    setError(err instanceof Error ? err.message : '알 수 없는 오류가 발생했습니다. 다시 시도해 주세요.');
                } finally {
                    setIsLoading(false);
                }
            }, [initialPrompt]);

            return e('div', { className: "min-h-screen bg-emerald-50 flex items-center justify-center p-4 sm:p-6 lg:p-8 font-sans" },
                e('div', { className: "w-full max-w-7xl bg-white rounded-3xl shadow-2xl shadow-emerald-200/50 border border-emerald-200/70 overflow-hidden flex flex-col" },
                    e('header', { className: "p-6 sm:p-8 border-b border-emerald-200" },
                        e('div', { className: "flex items-center gap-4" },
                            e('div', { className: "inline-flex items-center justify-center bg-emerald-100 text-emerald-600 p-3 rounded-xl flex-shrink-0" },
                                e(SparklesIcon, { className: "w-7 h-7 sm:w-8 sm:h-8" })
                            ),
                            e('div', null,
                                e('h1', { className: "text-2xl sm:text-3xl font-bold tracking-tight text-slate-800" }, "AI 프롬프트 개선기"),
                                e('p', { className: "mt-1 text-slate-500 max-w-2xl text-sm sm:text-base" }, "단순한 아이디어를 모든 AI 모델을 위한 강력하고 상세한 프롬프트로 변환하세요.")
                            )
                        )
                    ),
                    e('main', { className: "grid grid-cols-1 lg:grid-cols-2 flex-grow min-h-[600px] lg:min-h-[650px]" },
                        e('div', { className: "p-6 sm:p-8 lg:border-r lg:border-emerald-200" },
                            e(PromptInput, {
                                prompt: initialPrompt,
                                setPrompt: setInitialPrompt,
                                onSubmit: handleEnhancePrompt,
                                isLoading: isLoading
                            })
                        ),
                        e('div', { className: "p-6 sm:p-8 border-t border-emerald-200 lg:border-t-0" },
                            e(SuggestionsDisplay, {
                                suggestions: enhancedPrompts,
                                isLoading: isLoading,
                                error: error,
                                initialPrompt: initialPrompt
                            })
                        )
                    ),
                    e('footer', { className: "text-center py-4 px-6 text-slate-400 text-xs border-t border-emerald-200 bg-emerald-50/50" },
                        e('p', null, "© 2025 KH KIM. All Rights Reserved.")
                    )
                )
            );
        };

        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(e(App));
    </script>
</body>
</html>